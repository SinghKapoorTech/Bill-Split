---
title: Bills Collection Schema
date: 2026-02-20
tags: [database, schema, firestore, bills]
---

# `bills` Collection

The `bills` collection is the core transactional entity of the application. It represents a single receipt/event that is being split among multiple people. These documents are heavily updated in real-time during collaborative sessions.

## Document ID
Auto-generated by Firestore.

## Schema (`Bill`)

| Field          | Type              | Description                                                |
| -------------- | ----------------- | ---------------------------------------------------------- |
| `id`           | String            | The document ID.                                           |
| `title`        | String (Optional) | Custom name for the bill.                                  |
| `billType`     | String            | Enum: `'private'` \| `'group'`.                            |
| `status`       | String            | Enum: `'active'` \| `'archived'`.                          |
| `ownerId`      | String            | Ref to **[Users](users.md)** (Creator).                    |
| `tripId`       | String (Optional) | Ref to **[Trips](trips.md)** (if `billType === 'group'`).  |
| `squadId`      | String (Optional) | Ref to **[Squads](squads.md)** (if imported from a squad). |
| `createdAt`    | Timestamp         | Creation time.                                             |
| `updatedAt`    | Timestamp         | Last modification time.                                    |
| `lastActivity` | Timestamp         | Tracks latest interaction.                                 |

### Financial Data (`billData`)
Stores the actual money values involved.
- `restaurantName` (String, Optional)
- `subtotal`, `tax`, `tip`, `total` (Numbers)
- `items`: Array of Objects (`{ id, name, price }`)

### Participant Data
- **`members`**: Array of `BillMember` objects. Records who officially joined the session (`userId`, `name`, `joinedAt`, `isAnonymous`).
- **`people`**: Array of local Person objects (`{ id, name }`). This is a working array used during the session to track everyone involved, even if they haven't "joined" digitally (e.g., manually added friends).

### Assignment Data
- **`itemAssignments`**: A Map (Record) where the key is the `itemId` and the value is an array of `personId`s sharing that item. 
  - *Example:* `{ "item_123": ["userA", "userB"] }`
- **`splitEvenly`**: Boolean flag. If true, `itemAssignments` is forcefully overridden so every person is on every item.

### Session & Sharing
- `currentStep`: Number tracking wizard progress.
- `receiptImageUrl` / `receiptFileName`: Firebase Storage references.
- `shareCode`: 6-character shortcode for joining.
- `shareCodeExpiresAt` / `shareCodeCreatedAt`: Timestamps managing link validity.

## Concurrency & Relationships
- Because multiple users might claim an item simultaneously, updates to `itemAssignments` and `people` heavily utilize Firestore's atomic `arrayUnion` and `arrayRemove` operations to prevent race conditions.
- Uses references to **[Users](users.md)**, **[Trips](trips.md)**, and **[Squads](squads.md)**.
